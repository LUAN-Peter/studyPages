<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JavaScript Memory Management | Chaoxiang&#39;s Study Notes</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/github-markdown-css/2.2.1/github-markdown.css">
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/studyPages/assets/css/0.styles.d1a6705c.css" as="style"><link rel="preload" href="/studyPages/assets/js/app.b38cab34.js" as="script"><link rel="preload" href="/studyPages/assets/js/2.1626cb31.js" as="script"><link rel="preload" href="/studyPages/assets/js/5.f2c33806.js" as="script"><link rel="prefetch" href="/studyPages/assets/js/10.35ace908.js"><link rel="prefetch" href="/studyPages/assets/js/11.087a96f6.js"><link rel="prefetch" href="/studyPages/assets/js/12.f0e6442a.js"><link rel="prefetch" href="/studyPages/assets/js/13.5e386017.js"><link rel="prefetch" href="/studyPages/assets/js/14.c87a4647.js"><link rel="prefetch" href="/studyPages/assets/js/15.02e1028a.js"><link rel="prefetch" href="/studyPages/assets/js/16.27d3c376.js"><link rel="prefetch" href="/studyPages/assets/js/17.ca0774d0.js"><link rel="prefetch" href="/studyPages/assets/js/18.915810d3.js"><link rel="prefetch" href="/studyPages/assets/js/19.b1da4c38.js"><link rel="prefetch" href="/studyPages/assets/js/20.018fba21.js"><link rel="prefetch" href="/studyPages/assets/js/21.64dab9d9.js"><link rel="prefetch" href="/studyPages/assets/js/22.6775df76.js"><link rel="prefetch" href="/studyPages/assets/js/23.f3593274.js"><link rel="prefetch" href="/studyPages/assets/js/24.3a7e16bd.js"><link rel="prefetch" href="/studyPages/assets/js/25.13485e0a.js"><link rel="prefetch" href="/studyPages/assets/js/26.d0f87dff.js"><link rel="prefetch" href="/studyPages/assets/js/27.56c84efb.js"><link rel="prefetch" href="/studyPages/assets/js/28.c6af8a09.js"><link rel="prefetch" href="/studyPages/assets/js/29.b4036b19.js"><link rel="prefetch" href="/studyPages/assets/js/3.73690c6a.js"><link rel="prefetch" href="/studyPages/assets/js/30.825317f9.js"><link rel="prefetch" href="/studyPages/assets/js/31.ed696c4b.js"><link rel="prefetch" href="/studyPages/assets/js/32.9913bcdf.js"><link rel="prefetch" href="/studyPages/assets/js/4.0bf5fde3.js"><link rel="prefetch" href="/studyPages/assets/js/6.83bf3420.js"><link rel="prefetch" href="/studyPages/assets/js/7.826098d5.js"><link rel="prefetch" href="/studyPages/assets/js/8.c864b340.js"><link rel="prefetch" href="/studyPages/assets/js/9.3b04fc4a.js">
    <link rel="stylesheet" href="/studyPages/assets/css/0.styles.d1a6705c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/studyPages/" class="home-link router-link-active"><!----> <span class="site-name">Chaoxiang's Study Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/studyPages/" class="nav-link">
  HOME
</a></div><div class="nav-item"><a href="/studyPages/algorithm/" class="nav-link">
  ALGORITHM
</a></div><div class="nav-item"><a href="/studyPages/javascript/" class="nav-link router-link-active">
  JAVASCRIPT
</a></div><div class="nav-item"><a href="/studyPages/article/" class="nav-link">
  ARTICLE
</a></div><div class="nav-item"><a href="https://github.com/LUAN-Peter" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GITHUB
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/studyPages/" class="nav-link">
  HOME
</a></div><div class="nav-item"><a href="/studyPages/algorithm/" class="nav-link">
  ALGORITHM
</a></div><div class="nav-item"><a href="/studyPages/javascript/" class="nav-link router-link-active">
  JAVASCRIPT
</a></div><div class="nav-item"><a href="/studyPages/article/" class="nav-link">
  ARTICLE
</a></div><div class="nav-item"><a href="https://github.com/LUAN-Peter" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GITHUB
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/studyPages/javascript/" aria-current="page" class="sidebar-link">JavaScript</a></li><li><a href="/studyPages/javascript/dataType.html" class="sidebar-link">Data Types</a></li><li><a href="/studyPages/javascript/object.html" class="sidebar-link">Object</a></li><li><a href="/studyPages/javascript/prototype.html" class="sidebar-link">Prototype Chain</a></li><li><a href="/studyPages/javascript/inheritance.html" class="sidebar-link">JavaScript Inheritance</a></li><li><a href="/studyPages/javascript/context.html" class="sidebar-link">Execution Context</a></li><li><a href="/studyPages/javascript/jsmemory.html" aria-current="page" class="active sidebar-link">Memory Mangement</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/studyPages/javascript/jsmemory.html#how-allocate-memory" class="sidebar-link">How allocate memory</a></li><li class="sidebar-sub-header"><a href="/studyPages/javascript/jsmemory.html#why-need-stack-heap-space" class="sidebar-link">Why need Stack &amp; Heap Space</a></li><li class="sidebar-sub-header"><a href="/studyPages/javascript/jsmemory.html#garbage-collection" class="sidebar-link">Garbage Collection</a></li></ul></li><li><a href="/studyPages/javascript/eventExec.html" class="sidebar-link">Events Execution</a></li><li><a href="/studyPages/javascript/processThread.html" class="sidebar-link">Process Thread</a></li><li><a href="/studyPages/javascript/eventPropagation.html" class="sidebar-link">Event Propagation</a></li><li><a href="/studyPages/javascript/debounce.html" class="sidebar-link">Debounce</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="javascript-memory-management">JavaScript Memory Management</h1> <p>Unlike the C/C++, we do not need to operate the memory on our own. The JavaScript engine allocates or frees memory automatically. But if we want to build up high-performanced Web application, we must have clear understanding it. Besides, it can help us understand the <code>Execution Logic of JavaScript</code> better.<br>
As for memory management, it should contains at least 3 parts:</p> <ul><li>Allocation of memory(Store).</li> <li>Usage of memory.</li> <li>Release or free memory has allocated. (Garbage Collection)</li></ul> <p>Referenced by <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Memory_Management" target="_blank" rel="noopener noreferrer">MDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="how-allocate-memory">How allocate memory</h2> <p>As mentioned before in <a href="/studyPages/javascript/dataType.html">JavaScript Data Types</a>, JavaScript is a <strong>Dynamic &amp; Weak</strong> programming language, which means its variable can be interpreted as any type of data(Dynamic), and can be 'implicitly conversed' into another type(Weak). Besides, there are 2 data types of JavaScript: primitive or structural type.<br>
So here we throw the conclusion directly:</p> <ul><li>No matter what types of data they are, the memory always store bits like '...010...011...'.</li> <li>Primitive store in the <strong>Stack</strong>.</li> <li>Structural type data store in both <strong>Stack</strong> and <strong>Heap</strong>.</li></ul> <div class="custom-block tip"><p class="custom-block-title">Recognization of data type</p> <p>I have read an article about the source code of v8 engine. It recognize the data type by the last few bits of data.<br>
For example, if the binary sequence is end with <code>000</code>, v8 engine will regard it as an <code>Object</code>. However, <code>null</code> is also end with <code>000</code>! That's the reason why <code>typeof null</code> would return <code>true</code>. The <a href="https://2ality.com/2013/10/typeof-null.html" target="_blank" rel="noopener noreferrer">strategy<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is Hamming Code.</p> <p>ECMAScript has released a fixed <a href="https://web.archive.org/web/20160331031419/http://wiki.ecmascript.org:80/doku.php?id=harmony:typeof_null" target="_blank" rel="noopener noreferrer">proposal<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> in 2016 while it has been rejected because of compability.</p></div> <h3 id="runtime-model">Runtime Model</h3> <p>Runtime model consists of a <strong>Stack Space</strong>, <strong>Heap Space</strong> and <strong>Queue Space</strong>, as showing below:
<img src="/studyPages/assets/img/MemoryStructure1.69d06da1.png" alt="Image"></p> <p><strong>Stack</strong>, also named as <strong>Call Stack</strong>, is used to store the <code>Executive Of Context(EOC)</code>.<br> <strong>Heap</strong> is a bulk of storage that we store <strong>Object</strong> data. They may be disordered in a lower dimension.<br> <strong>Queue</strong> is a list of messages need to be processed later. We would clarify in <a href="/studyPages/javascript/eventExec.html">Event Execution</a>.<br>
For example, if we run the following code:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">'Peter'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> n2 <span class="token operator">=</span> name<span class="token punctuation">;</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Peter'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>The stack will store the variables:<br> <img src="/studyPages/assets/img/MemoryStructure2.2587cba3.png" alt="Image"><br>
Obviously, we store the address of the referenced in Stack and the real data are stored in the Heap. Hence, if we declare a new variable <code>obj2</code> and run <code>obj2 = obj</code>. <code>obj</code> will pass the <code>[addr]</code>(address) to <code>obj2</code>, which mean they are pointing to the same object! The image shows the procedure:
<img src="/studyPages/assets/img/MemoryStructure3.716cd8f3.png" alt="Image"></p> <h2 id="why-need-stack-heap-space">Why need Stack &amp; Heap Space</h2> <p>People may issue question like this: <em>can we store all data in stack space?</em> The answer is <strong>Nope</strong>. It is related to switching of <strong>COE(Context of Execution)</strong>. We modify our code a little:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">'Mary'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">'Peter'</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> n2 <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Peter'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>JavaScript will enter <code>f()</code>'s COE while executing <code>let obj = { name: 'Peter' };</code> in <code>f()</code>. The memory is shown like this:
<img src="/studyPages/assets/img/MemoryStructure4.26ae5503.png" alt="Image"><br>
In the <code>f()</code>'s COE, the property <code>name</code> is <code>Peter</code> instead of <code>Mary</code>. Stack is used to maintain the property of COE. However, we have to do the garbage collection and recover after execution. We move the <strong>Stack-top pointer</strong> to the <code>Global COE</code> marking the current <code>evironment</code> -- another name of COE.<br>
Generally, the data in Heap can be arbitrarily huge. As a result, if we put them into the Stack, it would take a long time to do the recovery which would affect the execution of next function. Tackfully, if we keep them in Heap, we can recovery them when there is no urgent task.</p> <h2 id="garbage-collection">Garbage Collection</h2></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">7/13/2021, 8:01:10 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/studyPages/javascript/context.html" class="prev">
        Execution Context
      </a></span> <span class="next"><a href="/studyPages/javascript/eventExec.html">
        Events Execution
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/studyPages/assets/js/app.b38cab34.js" defer></script><script src="/studyPages/assets/js/2.1626cb31.js" defer></script><script src="/studyPages/assets/js/5.f2c33806.js" defer></script>
  </body>
</html>
