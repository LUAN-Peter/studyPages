(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{376:function(e,t,a){e.exports=a.p+"assets/img/MemoryStructure1.69d06da1.png"},377:function(e,t,a){e.exports=a.p+"assets/img/MemoryStructure2.2587cba3.png"},378:function(e,t,a){e.exports=a.p+"assets/img/MemoryStructure3.716cd8f3.png"},379:function(e,t,a){e.exports=a.p+"assets/img/MemoryStructure4.26ae5503.png"},412:function(e,t,a){"use strict";a.r(t);var s=a(44),r=Object(s.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"javascript-memory-management"}},[e._v("JavaScript Memory Management")]),e._v(" "),s("p",[e._v("Unlike the C/C++, we do not need to operate the memory on our own. The JavaScript engine allocates or frees memory automatically. But if we want to build up high-performanced Web application, we must have clear understanding it. Besides, it can help us understand the "),s("code",[e._v("Execution Logic of JavaScript")]),e._v(" better."),s("br"),e._v("\nAs for memory management, it should contains at least 3 parts:")]),e._v(" "),s("ul",[s("li",[e._v("Allocation of memory(Store).")]),e._v(" "),s("li",[e._v("Usage of memory.")]),e._v(" "),s("li",[e._v("Release or free memory has allocated. (Garbage Collection)")])]),e._v(" "),s("p",[e._v("Referenced by "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Memory_Management",target:"_blank",rel:"noopener noreferrer"}},[e._v("MDN"),s("OutboundLink")],1)]),e._v(" "),s("h2",{attrs:{id:"how-allocate-memory"}},[e._v("How allocate memory")]),e._v(" "),s("p",[e._v("As mentioned before in "),s("RouterLink",{attrs:{to:"/javascript/dataType.html"}},[e._v("JavaScript Data Types")]),e._v(", JavaScript is a "),s("strong",[e._v("Dynamic & Weak")]),e._v(" programming language, which means its variable can be interpreted as any type of data(Dynamic), and can be 'implicitly conversed' into another type(Weak). Besides, there are 2 data types of JavaScript: primitive or structural type."),s("br"),e._v("\nSo here we throw the conclusion directly:")],1),e._v(" "),s("ul",[s("li",[e._v("No matter what types of data they are, the memory always store bits like '...010...011...'.")]),e._v(" "),s("li",[e._v("Primitive store in the "),s("strong",[e._v("Stack")]),e._v(".")]),e._v(" "),s("li",[e._v("Structural type data store in both "),s("strong",[e._v("Stack")]),e._v(" and "),s("strong",[e._v("Heap")]),e._v(".")])]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("Recognization of data type")]),e._v(" "),s("p",[e._v("I have read an article about the source code of v8 engine. It recognize the data type by the last few bits of data."),s("br"),e._v("\nFor example, if the binary sequence is end with "),s("code",[e._v("000")]),e._v(", v8 engine will regard it as an "),s("code",[e._v("Object")]),e._v(". However, "),s("code",[e._v("null")]),e._v(" is also end with "),s("code",[e._v("000")]),e._v("! That's the reason why "),s("code",[e._v("typeof null")]),e._v(" would return "),s("code",[e._v("true")]),e._v(". The "),s("a",{attrs:{href:"https://2ality.com/2013/10/typeof-null.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("strategy"),s("OutboundLink")],1),e._v(" is Hamming Code.")]),e._v(" "),s("p",[e._v("ECMAScript has released a fixed "),s("a",{attrs:{href:"https://web.archive.org/web/20160331031419/http://wiki.ecmascript.org:80/doku.php?id=harmony:typeof_null",target:"_blank",rel:"noopener noreferrer"}},[e._v("proposal"),s("OutboundLink")],1),e._v(" in 2016 while it has been rejected because of compability.")])]),e._v(" "),s("h3",{attrs:{id:"runtime-model"}},[e._v("Runtime Model")]),e._v(" "),s("p",[e._v("Runtime model consists of a "),s("strong",[e._v("Stack Space")]),e._v(", "),s("strong",[e._v("Heap Space")]),e._v(" and "),s("strong",[e._v("Queue Space")]),e._v(", as showing below:\n"),s("img",{attrs:{src:a(376),alt:"Image"}})]),e._v(" "),s("p",[s("strong",[e._v("Stack")]),e._v(", also named as "),s("strong",[e._v("Call Stack")]),e._v(", is used to store the "),s("code",[e._v("Executive Of Context(EOC)")]),e._v("."),s("br"),e._v(" "),s("strong",[e._v("Heap")]),e._v(" is a bulk of storage that we store "),s("strong",[e._v("Object")]),e._v(" data. They may be disordered in a lower dimension."),s("br"),e._v(" "),s("strong",[e._v("Queue")]),e._v(" is a list of messages need to be processed later. We would clarify in "),s("RouterLink",{attrs:{to:"/javascript/eventExec.html"}},[e._v("Event Execution")]),e._v("."),s("br"),e._v("\nFor example, if we run the following code:")],1),e._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("let")]),e._v(" name "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'Peter'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("let")]),e._v(" n2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("let")]),e._v(" obj "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" name"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'Peter'")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),s("p",[e._v("The stack will store the variables:"),s("br"),e._v(" "),s("img",{attrs:{src:a(377),alt:"Image"}}),s("br"),e._v("\nObviously, we store the address of the referenced in Stack and the real data are stored in the Heap. Hence, if we declare a new variable "),s("code",[e._v("obj2")]),e._v(" and run "),s("code",[e._v("obj2 = obj")]),e._v(". "),s("code",[e._v("obj")]),e._v(" will pass the "),s("code",[e._v("[addr]")]),e._v("(address) to "),s("code",[e._v("obj2")]),e._v(", which mean they are pointing to the same object! The image shows the procedure:\n"),s("img",{attrs:{src:a(378),alt:"Image"}})]),e._v(" "),s("h2",{attrs:{id:"why-need-stack-heap-space"}},[e._v("Why need Stack & Heap Space")]),e._v(" "),s("p",[e._v("People may issue question like this: "),s("em",[e._v("can we store all data in stack space?")]),e._v(" The answer is "),s("strong",[e._v("Nope")]),e._v(". It is related to switching of "),s("strong",[e._v("COE(Context of Execution)")]),e._v(". We modify our code a little:")]),e._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("let")]),e._v(" name "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'Mary'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("f")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("let")]),e._v(" name "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'Peter'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("let")]),e._v(" n2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("let")]),e._v(" obj "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" name"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'Peter'")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("f")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),s("p",[e._v("JavaScript will enter "),s("code",[e._v("f()")]),e._v("'s COE while executing "),s("code",[e._v("let obj = { name: 'Peter' };")]),e._v(" in "),s("code",[e._v("f()")]),e._v(". The memory is shown like this:\n"),s("img",{attrs:{src:a(379),alt:"Image"}}),s("br"),e._v("\nIn the "),s("code",[e._v("f()")]),e._v("'s COE, the property "),s("code",[e._v("name")]),e._v(" is "),s("code",[e._v("Peter")]),e._v(" instead of "),s("code",[e._v("Mary")]),e._v(". Stack is used to maintain the property of COE. However, we have to do the garbage collection and recover after execution. We move the "),s("strong",[e._v("Stack-top pointer")]),e._v(" to the "),s("code",[e._v("Global COE")]),e._v(" marking the current "),s("code",[e._v("evironment")]),e._v(" -- another name of COE."),s("br"),e._v("\nGenerally, the data in Heap can be arbitrarily huge. As a result, if we put them into the Stack, it would take a long time to do the recovery which would affect the execution of next function. Tackfully, if we keep them in Heap, we can recovery them when there is no urgent task.")]),e._v(" "),s("h2",{attrs:{id:"garbage-collection"}},[e._v("Garbage Collection")])])}),[],!1,null,null,null);t.default=r.exports}}]);